import{aB as I,aD as U,aE as B,aJ as K,U as W,r as v,c as G,o as O,l as g,m as S,n as y,p as o,ay as X,f as i,Q as p,S as $,R as T,aK as q,W as j,aF as Y,F as Z,t as ee,u as ae}from"./index.8ad7176f.js";import{Q as x}from"./QSeparator.ddcfa8c8.js";import{Q as le}from"./QImg.1d917fdb.js";import{Q as _}from"./QInput.a7de4db3.js";import{a as F,Q as N}from"./QCard.93c1c255.js";import{Q as te}from"./QPage.bbe672aa.js";import{f as ie,a as se,u as oe,c as re}from"./albumsService.bfca893a.js";import{g as ne}from"./routeHelpers.33bdd260.js";import{H as b}from"./loaderUtils.b57ef548.js";import{u as de}from"./notificationUtils.74098a83.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.186307de.js";import"./use-timeout.24e0f3c2.js";import"./focus-manager.40072c15.js";const ce=async c=>{try{const u=await I.post("/stickers",c,{headers:{"Content-Type":"application/json"}});return U(u)}catch(u){throw B(u)}},me=async(c,u)=>{try{const k=await I.put(`/stickers/${c}`,u,{headers:{"Content-Type":"application/json"}});return U(k)}catch(k){throw B(k)}},ve=async c=>{try{const u=await I.delete(`/stickers/${c}`,{headers:{"Content-Type":"application/json"}});return U(u)}catch(u){throw B(u)}};const z=c=>(ee("data-v-0b63bc78"),c=c(),ae(),c),pe={class:"row items-center justify-between q-mt-md q-mb-md q-mx-md"},be={class:"text-h4"},fe={class:"row q-gutter-md q-pa-md items-start q-mx-md"},ge={class:"col-12 col-md-2 image-container"},he={class:"q-pa-md flex flex-center full-width full-height"},ye={key:0,class:"q-pa-md flex flex-center full-width full-height"},ke={class:"col-12 col-md-9"},_e={class:"row justify-end q-pa-md q-mx-md"},we={class:"q-mx-md"},Se=z(()=>o("div",{class:"row items-center justify-between q-mt-md q-mb-md"},[o("div",{class:"text-h4"},"Criar figurinha")],-1)),qe={class:"col-10"},Ce={class:"col-2 row items-center"},Ve=z(()=>o("div",{class:"row items-center justify-between q-mt-md q-mb-md"},[o("div",{class:"text-h4"},"Figurinhas do \xE1lbum")],-1)),De={class:"col-10"},Ee={class:"col-2 row items-center"},Ae={__name:"AlbumPage",setup(c){const u=K(),k=W(),{showSuccessNotification:w,showErrorNotification:h}=de(),s=v(u.params.id||null),C=v(null),l=v({imageUrl:null,imageBase64:"",title:"",description:"",community:!1,shared:!1,blocked:!1,editable:!1}),V=v(null),D=v(null),r=v({title:"",description:"",editable:!1}),n=v([]),P=G(()=>!!s.value),f=v({albumTitle:"",albumDescription:"",cardStickerTitle:"",cardStickerDescription:""}),Q=v(null),H=async()=>{Q.value.click()},L=t=>{try{const e=t.target.files[0];if(e){const a=new FileReader;a.onload=m=>{l.value.imageUrl=m.target.result,l.value.imageBase64=new String(m.target.result).split(",")[1]},a.readAsDataURL(e)}}catch(e){h(e.message)}finally{}};O(async()=>{if(P.value){b.show("Aguarde... Estamos carregando os dados para voc\xEA...");try{const t=await ie(s.value);t&&(l.value.imageUrl=t.imageUrl,l.value.title=t.title,l.value.description=t.description,l.value.community=t.community,l.value.shared=t.shared,l.value.blocked=t.blocked);const{stickers:e}=await se(s.value);for(let a=0;a<e.length;a++){const m=e[a];m.editable=!1,n.value.push(m)}}catch(t){h(t.message)}finally{b.hide()}}});const M=()=>{k.push(ne("inicio"))},E=async t=>{if(t==="edit")f.value.albumTitle=l.value.title,f.value.albumDescription=l.value.description;else if(t==="cancel")l.value.title=f.value.albumTitle,l.value.description=f.value.albumDescription,C.value.resetValidation();else{if(C.value.validate(),C.value.hasError)return;try{if(b.show("Aguarde... Estamos salvando os dados para voc\xEA..."),s.value){const e=await oe(s.value,{id:s.value,imageBase64:l.value.imageBase64,title:l.value.title,description:l.value.description,community:l.value.community,shared:l.value.shared,blocked:l.value.shared});e.data&&w(e.message)}else{const e=await re({imageBase64:l.value.imageBase64,title:l.value.title,description:l.value.description,community:l.value.community});e.data&&(s.value=e.data.id,k.push(`/edu/album/${s.value}`),w(e.message))}}catch(e){h(e.message)}finally{b.hide()}}l.value.editable=t==="add"?!1:!l.value.editable},A=async t=>{if(t==="cancel")r.value.title="",r.value.description="",V.value.resetValidation(),D.value.resetValidation();else{if(!s.value||(V.value.validate(),D.value.validate(),V.value.hasError||D.value.hasError))return;if(r.value.editable)try{b.show("Aguarde... Estamos salvando os dados para voc\xEA...");const e=await ce({title:r.value.title,description:r.value.description,albumId:s.value});e&&(n.value.push({id:e.data.id,title:e.data.title,description:e.data.description,editable:!1}),r.value.title="",r.value.description="",w(e.message))}catch(e){h(e.message)}finally{b.hide()}}r.value.editable=!r.value.editable},R=async(t,e)=>{if(e==="edit")f.value.cardStickerTitle=n.value[t].title,f.value.cardStickerDescription=n.value[t].description;else if(e==="cancel")n.value[t].title=f.value.cardStickerTitle,n.value[t].description=f.value.cardStickerDescription;else{if(new String(n.value[t].title).length==0||new String(n.value[t].description).length==0){h("Aten\xE7\xE3o! Certifique-se que os dados est\xE3o preenchidos corretamente.");return}if(n.value[t].editable)try{const a=await me(n.value[t].id,{id:n.value[t].id,title:n.value[t].title,description:n.value[t].description,albumId:s.value});a&&w(a.message)}catch(a){h(a.message)}finally{b.hide()}}n.value[t].editable=!n.value[t].editable},J=async t=>{try{b.show("Aguarde... Estamos removendo a figurinha do \xE1lbum...");const e=await ve(n.value[t].id);e&&(n.value.splice(t,1),w(e.message))}catch(e){h(e.message)}finally{b.hide()}};return(t,e)=>(g(),S(te,{class:"q-pa-md"},{default:y(()=>[o("div",pe,[o("div",be,X(s.value?"Editar":"Criar")+" \xC1lbum",1),i(p,{rounded:"",color:"primary",class:"button",icon:"home",label:"In\xEDcio",onClick:M})]),i(x,{class:"q-my-md q-mx-md"}),o("form",{onSubmit:j(E,["prevent","stop"])},[o("div",fe,[o("div",ge,[i(le,{src:l.value.imageUrl},{error:y(()=>[o("div",he,[i($,{name:"warning",size:"64px",color:"grey-4"})])]),default:y(()=>[l.value.imageUrl?q("",!0):(g(),T("div",ye,[i($,{name:"add_photo_alternate",size:"64px",color:"grey-4"})]))]),_:1},8,["src"]),i(p,{rounded:"",color:"primary",label:"Carregar",icon:"upload",disable:s.value&&!l.value.editable,onClick:e[0]||(e[0]=a=>H())},null,8,["disable"]),o("input",{type:"file",ref_key:"fileInput",ref:Q,onChange:L,accept:"image/*",style:{display:"none"}},null,544)]),o("div",ke,[i(_,{rounded:"",outlined:"",ref_key:"albumDataTitleRef",ref:C,modelValue:l.value.title,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.title=a),label:"T\xEDtulo *",class:"q-mb-md",disable:s.value&&!l.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para o \xE1lbum."]},null,8,["modelValue","disable","rules"]),i(_,{rounded:"",outlined:"",modelValue:l.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.description=a),label:"Descri\xE7\xE3o",type:"textarea",class:"q-mb-md",disable:s.value&&!l.value.editable},null,8,["modelValue","disable"])])]),o("div",_e,[i(p,{rounded:"",class:"button",color:"primary",label:s.value?l.value.editable?"Salvar":"Editar":"Criar novo",icon:s.value?l.value.editable?"save":"edit":"add",onClick:e[3]||(e[3]=a=>E(s.value?l.value.editable?"save":"edit":"add"))},null,8,["label","icon"]),l.value.editable?(g(),S(p,{key:0,rounded:"",color:"negative",label:"Cancelar",icon:"cancel",onClick:e[4]||(e[4]=a=>E("cancel"))})):q("",!0)])],32),i(x,{class:"q-my-md q-mx-md"}),o("div",we,[Se,o("form",{onSubmit:j(A,["prevent","stop"])},[i(N,{class:"q-mb-md rounded-card"},{default:y(()=>[i(F,{class:"row items-center justify-between"},{default:y(()=>[o("div",qe,[i(_,{rounded:"",outlined:"",ref_key:"formStickerTitleRef",ref:V,modelValue:r.value.title,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.title=a),label:"T\xEDtulo *",class:"q-mb-sm",disable:!r.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para a figurinha."]},null,8,["modelValue","disable","rules"]),i(_,{rounded:"",outlined:"",ref_key:"formStickerDescriptionRef",ref:D,modelValue:r.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.description=a),label:"Descri\xE7\xE3o *",type:"textarea",disable:!r.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar uma descri\xE7\xE3o para a figurinha."]},null,8,["modelValue","disable","rules"])]),o("div",Ce,[i(p,{rounded:"",color:"primary",disable:!s.value,label:r.value.editable?"Salvar":"Criar nova",icon:r.value.editable?"save":"add",onClick:e[7]||(e[7]=a=>A("add")),class:"q-ml-md"},null,8,["disable","label","icon"]),r.value.editable?(g(),S(p,{key:0,rounded:"",color:"negative",label:"Cancelar",icon:"cancel",onClick:e[8]||(e[8]=a=>A("cancel")),class:"q-ml-md"})):q("",!0)])]),_:1})]),_:1})],32),Ve,(g(!0),T(Z,null,Y(n.value,(a,m)=>(g(),T("div",{key:m,class:"q-mb-md"},[i(N,{class:"q-mb-md rounded-card"},{default:y(()=>[i(F,{class:"row items-center justify-between"},{default:y(()=>[o("div",De,[i(_,{rounded:"",outlined:"",modelValue:a.title,"onUpdate:modelValue":d=>a.title=d,label:"T\xEDtulo",disable:!a.editable,rules:[d=>d&&d.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para a figurinha."]},null,8,["modelValue","onUpdate:modelValue","disable","rules"]),i(_,{rounded:"",outlined:"",modelValue:a.description,"onUpdate:modelValue":d=>a.description=d,label:"Descri\xE7\xE3o",type:"textarea",disable:!a.editable,rules:[d=>d&&d.length>0||"\xC9 necess\xE1rio informar uma descri\xE7\xE3o para a figurinha."]},null,8,["modelValue","onUpdate:modelValue","disable","rules"])]),o("div",Ee,[i(p,{rounded:"",color:"primary",label:a.editable?"Salvar":"Editar",icon:a.editable?"save":"edit",onClick:d=>R(m,a.editable?"save":"edit"),class:"q-ml-md"},null,8,["label","icon","onClick"]),a.editable?(g(),S(p,{key:0,rounded:"",color:"negative",icon:"cancel",onClick:d=>R(m,"cancel"),label:"Cancelar",class:"q-ml-md"},null,8,["onClick"])):q("",!0),a.editable?q("",!0):(g(),S(p,{key:1,rounded:"",color:"negative",icon:"delete",label:"Excluir",onClick:d=>J(m),class:"q-ml-md"},null,8,["onClick"]))])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1}))}};var Le=ue(Ae,[["__scopeId","data-v-0b63bc78"]]);export{Le as default};
