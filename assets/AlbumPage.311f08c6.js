import{r as o,o as J,w as oe,k as c,l as y,m as s,f as a,R as I,n as i,Q as p,aK as k,aC as K,E as le,aJ as se,U as re,F as z,au as P,aB as ie,S as E,O as ne,p as ce,q as ue}from"./index.129f0960.js";import{Q as de}from"./QSeparator.85e6c696.js";import{a as q,Q as L}from"./QCard.e906fb3c.js";import{Q as me}from"./QImg.7f263b56.js";import{Q as pe}from"./QPage.9c84b3ad.js";import{Q as G,C as W}from"./ClosePopup.d91d73e6.js";import{Q as X}from"./QDialog.0c1997a9.js";import{a as ve}from"./albumsService.aacb70ea.js";import{c as fe,p as H}from"./userService.9bb42508.js";import{g as he}from"./routeHelpers.90713f5e.js";import{H as S}from"./loaderUtils.9e791bfa.js";import{u as Y}from"./notificationUtils.f93b8597.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.ab9d8e94.js";import"./use-timeout.26691309.js";import"./focusout.3dd22609.js";import"./focus-manager.40072c15.js";const _e={key:0,class:"video-container"},ge={key:1,class:"q-mt-md"},ye=["src"],ke={__name:"CameraModal",props:{isOpen:Boolean},emits:["photo-captured","close"],setup(C,{emit:V}){const{showErrorNotification:B}=Y(),D=C,_=V,g=o(D.isOpen),M=o(!1),b=o(!1),u=o(null),m=o(null),r=o(!1),v=o(null),A=o(null);J(()=>{navigator.mediaDevices.getUserMedia&&(M.value=!0)});const w=async()=>{try{const n=await navigator.mediaDevices.getUserMedia({video:!0});await le(),A.value&&(b.value=!0,A.value.srcObject=n,m.value=n.getVideoTracks()[0],u.value=new ImageCapture(m.value))}catch{B("Desculpe, ocorreu um erro ao acessar a cam\xEAra do dispositivo. Por favor, tente novamente em outro navegador.")}},F=()=>{u.value&&u.value.takePhoto().then(n=>{const f=new FileReader;f.readAsDataURL(n),f.onloadend=()=>{v.value=f.result,r.value=!0,Q()}}).catch(n=>{B("Desculpe, um erro ocorreu")})},Q=()=>{m.value&&m.value.stop()},N=()=>{_("close"),Q(),g.value=!1,r.value=!1,v.value=null},O=()=>{r.value=!1,v.value=null,w()},T=()=>{_("photo-captured",v.value),g.value=!1,r.value=!1,v.value=null};return oe(()=>D.isOpen,n=>{g.value=n,n&&w()}),(n,f)=>(c(),y(X,{modelValue:g.value,"onUpdate:modelValue":f[0]||(f[0]=$=>g.value=$),persistent:""},{default:s(()=>[a(L,{class:"q-pa-md",style:{"max-width":"90vw","max-height":"90vh"}},{default:s(()=>[a(q,{class:"text-center"},{default:s(()=>[r.value?(c(),I("div",ge,[i("img",{src:v.value,alt:"Foto Capturada",class:"captured-image"},null,8,ye)])):(c(),I("div",_e,[i("video",{ref_key:"videoplayRef",ref:A,autoplay:"",playsinline:"",class:"video"},null,512)]))]),_:1}),a(G,{align:"center",class:"q-pt-none"},{default:s(()=>[r.value?(c(),y(p,{key:0,color:"primary",icon:"publish",label:"Pronto",onClick:T,class:"full-width"})):k("",!0),r.value?(c(),y(p,{key:1,color:"primary",icon:"replay",label:"Tentar Novamente",onClick:O,class:"full-width q-mt-sm"})):k("",!0),r.value?k("",!0):(c(),y(p,{key:2,color:"primary",icon:"photo_camera",label:"Tirar Foto",onClick:F,disable:!b.value,class:"full-width"},null,8,["disable"])),K(a(p,{icon:"close",label:"Cancelar",color:"primary",onClick:N,class:"full-width q-mt-sm"},null,512),[[W]])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var Ce=Z(ke,[["__scopeId","data-v-1eeb2bf4"]]);const be=C=>(ce("data-v-da3704ae"),C=C(),ue(),C),we={class:"row items-center justify-between q-mt-md q-mb-md q-mx-md"},xe={class:"text-h5"},Se=be(()=>i("div",{class:"row q-mt-md q-mb-md q-mx-md text-caption"}," * Ao colar uma figurinha automaticamente ela ser\xE1 encaminhada para a corre\xE7\xE3o. A indica\xE7\xE3o no topo direito da figurinha indicar\xE1 se ela est\xE1 correta ou n\xE3o. N\xE3o havendo indica\xE7\xE3o, a figurinha ainda n\xE3o foi colada ou corrigida. ",-1)),qe={class:"row q-gutter-md section-card",flat:"",bordered:""},Ie={class:"text-h5 q-mt-sm q-mb-xs"},De={class:"text-caption"},Ae={key:0},Qe={class:"q-pa-md flex flex-center full-width full-height"},Ne={key:0,class:"q-pa-md flex flex-center full-width full-height"},Pe={class:"row q-gutter-sm"},Ve={class:"text-h6"},j=30,Be={__name:"AlbumPage",setup(C){const V=se(),B=re(),{showSuccessNotification:D,showErrorNotification:_}=Y(),g=o(V.params.id||null),M=o(V.params.name||""),b=o({}),u=o({id:0}),m=o({}),r=o({});J(()=>{A(g.value)});const v=()=>{B.push(he("inicio"))},A=async t=>{try{S.show("Aguarde... Carregando...");const{stickers:l}=await ve(t);if(l){b.value=l;const e=await fe(t);e&&b.value.forEach(d=>{var h=e.data.find(x=>x.stickerId===d.id);h&&(r.value[d.id]=h.imageUrl),h=e.data.find(x=>x.stickerId===d.id),h&&(m.value[d.id]=h.status)})}}catch(l){_(l.message)}finally{S.hide()}},w=o(!1),F=o(""),Q=o(""),N=t=>t.length>j,O=t=>N(t)?t.substring(0,j):t,T=(t,l)=>{F.value=t,Q.value=l,w.value=!0},n=o(null),f=async t=>{u.value.id=t,n.value.click()},$=t=>{try{const l=t.target.files[0];if(l){const e=new FileReader;e.onload=async d=>{const h=new String(d.target.result).split(",")[1];try{u.value.id>0&&h.length>0&&(S.show("Aguarde... estamos colando a figurinha para voc\xEA..."),await H({imageBase64:h,stickerId:u.value.id})&&(r.value[u.value.id]=d.target.result,D("Uhul! Nova figurinha adicionada!")))}catch(x){_(x.message)}finally{S.hide()}},e.readAsDataURL(l)}}catch(l){_(l.message)}finally{}},R=o(!1),U=o(null),ee=async t=>{R.value=!0,U.value=null,u.value.id=t},ae=async t=>{U.value=t,R.value=!1;try{const l=new String(U.value).split(",")[1];u.value.id>0&&l.length>0&&(S.show("Aguarde... estamos colando a figurinha para voc\xEA..."),await H({imageBase64:l,stickerId:u.value.id})&&(r.value[u.value.id]=t,D("Uhul! Nova figurinha adicionada!"),U.value=null))}catch(l){_(l.message)}finally{S.hide()}},te=()=>{R.value=!1};return(t,l)=>(c(),I(z,null,[a(pe,{class:"q-pa-lg"},{default:s(()=>[i("div",we,[i("div",xe,P(M.value),1),i("div",null,[a(p,{rounded:"",color:"primary",class:"button",icon:"home",label:"In\xEDcio",onClick:v})])]),a(de,{class:"q-my-md q-mx-md"}),Se,i("div",qe,[(c(!0),I(z,null,ie(b.value,e=>(c(),y(L,{key:e.id,class:"col-12 col-md-2 rounded-card",flat:"",bordered:""},{default:s(()=>[m.value[e.id]?(c(),y(E,{key:0,name:m.value[e.id]==="Aprovada"?"check_circle":"cancel",class:"absolute-top-right q-pa-md",color:m.value[e.id]==="Aprovada"?"green":"red",size:"25px"},null,8,["name","color"])):k("",!0),a(q,null,{default:s(()=>[i("div",Ie,P(e.title),1),i("div",De,[ne(P(O(e.description))+" ",1),N(e.description)?(c(),I("span",Ae,"...")):k("",!0),N(e.description)?(c(),y(p,{key:1,flat:"",dense:"",color:"primary",class:"text-caption",label:"Ver mais",onClick:d=>T(e.description,e.title)},null,8,["onClick"])):k("",!0)])]),_:2},1024),a(q,null,{default:s(()=>[a(me,{src:r.value[e.id]},{error:s(()=>[i("div",Qe,[a(E,{name:"warning",size:"64px",color:"grey-4"})])]),default:s(()=>[r.value[e.id]?k("",!0):(c(),I("div",Ne,[a(E,{name:"add_photo_alternate",size:"64px",color:"grey-4"})]))]),_:2},1032,["src"])]),_:2},1024),a(q,null,{default:s(()=>[i("div",Pe,[a(p,{class:"col",rounded:"",color:"primary",label:"Carregar",icon:"upload",onClick:d=>f(e.id)},null,8,["onClick"]),a(p,{class:"col",rounded:"",color:"primary",label:"Capturar",icon:"camera_alt",onClick:d=>ee(e.id)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),_:1}),a(X,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),persistent:""},{default:s(()=>[a(L,null,{default:s(()=>[a(q,null,{default:s(()=>[i("div",Ve,P(Q.value),1)]),_:1}),a(q,null,{default:s(()=>[i("div",null,P(F.value),1)]),_:1}),a(G,{align:"right"},{default:s(()=>[K(a(p,{flat:"",label:"Fechar",color:"primary"},null,512),[[W]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Ce,{isOpen:R.value,onPhotoCaptured:ae,onClose:te},null,8,["isOpen"]),i("input",{type:"file",ref_key:"fileInput",ref:n,onChange:$,accept:"image/*",style:{display:"none"}},null,544)],64))}};var Ye=Z(Be,[["__scopeId","data-v-da3704ae"]]);export{Ye as default};
