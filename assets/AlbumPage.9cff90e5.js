import{r as l,o as X,w as ie,k as n,l as g,m as s,f as a,U as A,n as i,Q as p,aK as _,af as Y,H as ne,aJ as ce,W as ue,F as W,t as F,aF as de,V as $,R as me,p as pe,q as ve}from"./index.edc29a52.js";import{Q as fe}from"./QSeparator.e937a380.js";import{a as D,Q as E}from"./QCard.e7161624.js";import{Q as J}from"./QImg.c02170e1.js";import{Q as he}from"./QPage.6fb0262f.js";import{Q as Z}from"./QCardActions.e3e911c4.js";import{Q as L}from"./QDialog.469f0366.js";import{C as ee}from"./ClosePopup.927470c4.js";import{a as ge}from"./albumsService.b2ec5465.js";import{c as _e,p as K}from"./userService.e0b5d1dd.js";import{g as ye}from"./routeHelpers.66ced929.js";import{H as q}from"./loaderUtils.92efe993.js";import{u as ae}from"./notificationUtils.be66973a.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.0e8cc155.js";import"./use-timeout.6517a5c0.js";import"./focusout.7e3dd1b4.js";import"./focus-manager.40072c15.js";const Ce={key:0,class:"video-container"},ke={key:1,class:"q-mt-md"},we=["src"],be={__name:"CameraModal",props:{isOpen:Boolean},emits:["photo-captured","close"],setup(k,{emit:U}){const{showErrorNotification:M}=ae(),Q=k,y=U,C=l(Q.isOpen),O=l(!1),w=l(!1),u=l(null),v=l(null),r=l(!1),d=l(null),b=l(null),x=l("environment");X(()=>{navigator.mediaDevices.getUserMedia&&(O.value=!0)});const V=async()=>{try{const c=await navigator.mediaDevices.getUserMedia({video:{facingMode:x.value}});await ne(),b.value&&(w.value=!0,b.value.srcObject=c,v.value=c.getVideoTracks()[0],u.value=new ImageCapture(v.value))}catch{M("Desculpe, ocorreu um erro ao acessar a cam\xEAra do dispositivo. Por favor, tente novamente em outro navegador.")}},N=()=>{u.value&&u.value.takePhoto().then(c=>{const f=new FileReader;f.readAsDataURL(c),f.onloadend=()=>{d.value=f.result,r.value=!0,S()}}).catch(c=>{M("Desculpe, um erro ocorreu")})},S=()=>{v.value&&v.value.stop()},R=()=>{y("close"),S(),C.value=!1,r.value=!1,d.value=null},P=()=>{r.value=!1,d.value=null,V()},H=()=>{y("photo-captured",d.value),C.value=!1,r.value=!1,d.value=null},j=()=>{x.value=x.value==="user"?"environment":"user",S(),V()};return ie(()=>Q.isOpen,c=>{C.value=c,c&&V()}),(c,f)=>(n(),g(L,{modelValue:C.value,"onUpdate:modelValue":f[0]||(f[0]=z=>C.value=z),persistent:""},{default:s(()=>[a(E,{class:"q-pa-md",style:{"max-width":"90vw","max-height":"90vh"}},{default:s(()=>[a(D,{class:"text-center"},{default:s(()=>[r.value?(n(),A("div",ke,[i("img",{src:d.value,alt:"Foto Capturada",class:"captured-image"},null,8,we)])):(n(),A("div",Ce,[i("video",{ref_key:"videoplayRef",ref:b,autoplay:"",playsinline:"",class:"video"},null,512)]))]),_:1}),a(Z,{align:"center",class:"q-pt-none"},{default:s(()=>[r.value?(n(),g(p,{key:0,color:"primary",icon:"publish",label:"Pronto",onClick:H,class:"full-width"})):_("",!0),r.value?(n(),g(p,{key:1,color:"primary",icon:"replay",label:"Tentar Novamente",onClick:P,class:"full-width q-mt-sm"})):_("",!0),r.value?_("",!0):(n(),g(p,{key:2,color:"primary",icon:"photo_camera",label:"Tirar Foto",onClick:N,disable:!w.value,class:"full-width"},null,8,["disable"])),r.value?_("",!0):(n(),g(p,{key:3,color:"primary",icon:"change_circle",label:x.value==="environment"?"C\xE2mera frontal":"C\xE2mera traseira",onClick:j,class:"full-width q-mt-sm"},null,8,["label"])),Y(a(p,{icon:"close",label:"Cancelar",color:"primary",onClick:R,class:"full-width q-mt-sm"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var xe=te(be,[["__scopeId","data-v-72d28cdb"]]);const Se=k=>(pe("data-v-4008bc9a"),k=k(),ve(),k),Ie={class:"row items-center justify-between q-mt-md q-mb-md q-mx-md"},qe={class:"text-h5"},De=Se(()=>i("div",{class:"row q-mt-md q-mb-md q-mx-md text-caption"}," * Ao colar uma figurinha automaticamente ela ser\xE1 encaminhada para a corre\xE7\xE3o. A indica\xE7\xE3o no topo direito da figurinha indicar\xE1 se ela est\xE1 correta ou n\xE3o. N\xE3o havendo indica\xE7\xE3o, a figurinha ainda n\xE3o foi colada ou corrigida. ",-1)),Ae={class:"row q-gutter-md section-card",flat:"",bordered:""},Qe={class:"text-h5 q-mt-sm q-mb-xs"},Ve={class:"text-caption"},Ne={key:0},Pe={class:"q-pa-md flex flex-center full-width full-height"},Fe={key:0,class:"q-pa-md flex flex-center full-width full-height"},Ue={class:"row q-gutter-sm"},Me={class:"text-h6"},G=30,Re={__name:"AlbumPage",setup(k){const U=ce(),M=ue(),{showSuccessNotification:Q,showErrorNotification:y}=ae(),C=l(U.params.id||null),O=l(U.params.name||""),w=l({}),u=l({id:0}),v=l({}),r=l({}),d=l(!1),b=l(!1);X(()=>{V(C.value)});const x=()=>{M.push(ye("inicio"))},V=async o=>{try{q.show("Aguarde... Carregando...");const{stickers:t}=await ge(o);if(t){w.value=t;const e=await _e(o);e&&w.value.forEach(m=>{var h=e.data.find(I=>I.stickerId===m.id);h&&(r.value[m.id]=h.imageUrl),h=e.data.find(I=>I.stickerId===m.id),h&&(v.value[m.id]=h.status)})}}catch(t){y(t.message)}finally{q.hide()}},N=l(!1),S=l(""),R=l(""),P=o=>o.length>G,H=o=>P(o)?o.substring(0,G):o,j=(o,t)=>{S.value=o,R.value=t,N.value=!0},c=l(null),f=async o=>{u.value.id=o,c.value.click()},z=o=>{try{const t=o.target.files[0];if(t){const e=new FileReader;e.onload=async m=>{const h=new String(m.target.result).split(",")[1];try{u.value.id>0&&h.length>0&&(q.show("Aguarde... estamos colando a figurinha para voc\xEA..."),await K({imageBase64:h,stickerId:u.value.id})&&(r.value[u.value.id]=m.target.result,Q("Uhul! Nova figurinha adicionada!")))}catch(I){y(I.message)}finally{q.hide()}},e.readAsDataURL(t)}}catch(t){y(t.message)}finally{}},B=l(!1),T=l(null),le=async o=>{B.value=!0,T.value=null,u.value.id=o},oe=async o=>{T.value=o,B.value=!1;try{const t=new String(T.value).split(",")[1];u.value.id>0&&t.length>0&&(q.show("Aguarde... estamos colando a figurinha para voc\xEA..."),await K({imageBase64:t,stickerId:u.value.id})&&(r.value[u.value.id]=o,Q("Uhul! Nova figurinha adicionada!"),T.value=null))}catch(t){y(t.message)}finally{q.hide()}},se=()=>{B.value=!1},re=o=>{console.log(1),b.value=o,d.value=!0};return(o,t)=>(n(),A(W,null,[a(he,{class:"q-pa-lg"},{default:s(()=>[i("div",Ie,[i("div",qe,F(O.value),1),i("div",null,[a(p,{rounded:"",color:"primary",class:"button",icon:"home",label:"In\xEDcio",onClick:x})])]),a(fe,{class:"q-my-md q-mx-md"}),De,i("div",Ae,[(n(!0),A(W,null,de(w.value,e=>(n(),g(E,{key:e.id,class:"col-12 col-md-2 rounded-card",flat:"",bordered:""},{default:s(()=>[v.value[e.id]?(n(),g($,{key:0,name:v.value[e.id]==="Aprovada"?"check_circle":"cancel",class:"absolute-top-right q-pa-md",color:v.value[e.id]==="Aprovada"?"green":"red",size:"25px"},null,8,["name","color"])):_("",!0),a(D,null,{default:s(()=>[i("div",Qe,F(e.title),1),i("div",Ve,[me(F(H(e.description))+" ",1),P(e.description)?(n(),A("span",Ne,"...")):_("",!0),P(e.description)?(n(),g(p,{key:1,flat:"",dense:"",color:"primary",class:"text-caption",label:"Ver mais",onClick:m=>j(e.description,e.title)},null,8,["onClick"])):_("",!0)])]),_:2},1024),a(D,{style:{height:"380px",display:"flex","align-items":"center","justify-content":"center"}},{default:s(()=>[a(J,{src:r.value[e.id],style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onClick:m=>re(r.value[e.id])},{error:s(()=>[i("div",Pe,[a($,{name:"warning",size:"64px",color:"grey-4"})])]),default:s(()=>[r.value[e.id]?_("",!0):(n(),A("div",Fe,[a($,{name:"add_photo_alternate",size:"64px",color:"grey-4"})]))]),_:2},1032,["src","onClick"])]),_:2},1024),a(D,null,{default:s(()=>[i("div",Ue,[a(p,{class:"col",rounded:"",color:"primary",label:"Carregar",icon:"upload",onClick:m=>f(e.id)},null,8,["onClick"]),a(p,{class:"col",rounded:"",color:"primary",label:"Capturar",icon:"camera_alt",onClick:m=>le(e.id)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),_:1}),a(L,{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=e=>N.value=e),persistent:""},{default:s(()=>[a(E,null,{default:s(()=>[a(D,null,{default:s(()=>[i("div",Me,F(R.value),1)]),_:1}),a(D,null,{default:s(()=>[i("div",null,F(S.value),1)]),_:1}),a(Z,{align:"right"},{default:s(()=>[Y(a(p,{flat:"",label:"Fechar",color:"primary"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(xe,{isOpen:B.value,onPhotoCaptured:oe,onClose:se},null,8,["isOpen"]),i("input",{type:"file",ref_key:"fileInput",ref:c,onChange:z,accept:"image/*",style:{display:"none"}},null,544),a(L,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e)},{default:s(()=>[a(J,{src:b.value,style:{width:"100%",height:"auto"}},null,8,["src"]),a($,{name:"close",size:"md",color:"white",class:"dialog-close-icon",onClick:t[1]||(t[1]=e=>d.value=!1)})]),_:1},8,["modelValue"])],64))}};var ta=te(Re,[["__scopeId","data-v-4008bc9a"]]);export{ta as default};
