import{aB as $,aD as F,aE as j,aJ as O,W as X,r as p,c as Z,o as ee,k as h,l as C,m as i,n as c,t as ae,f as l,Q as f,V as L,U as I,aK as V,Y as P,aF as le,F as te,p as se,q as ie}from"./index.a1e82d74.js";import{Q as H}from"./QSeparator.8084362a.js";import{Q as oe}from"./QImg.381c60d0.js";import{Q as T,a as k,b as _}from"./QList.98074e97.js";import{Q as q}from"./QInput.36573892.js";import{a as U,Q as B}from"./QCard.aa9fc32d.js";import{Q as R}from"./QCardActions.117c00cd.js";import{Q as re}from"./QPage.be4ec7b6.js";import{f as ue,a as de,u as ne,c as ce}from"./albumsService.113a37cc.js";import{g as me}from"./routeHelpers.1dd23cc9.js";import{H as b}from"./loaderUtils.b7ee209e.js";import{u as ve}from"./notificationUtils.b598cbd6.js";import{_ as pe}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.81f57250.js";import"./use-timeout.dd394135.js";import"./focus-manager.40072c15.js";import"./private.use-form.8ddaede4.js";const fe=async m=>{try{const n=await $.post("/stickers",m,{headers:{"Content-Type":"application/json"}});return F(n)}catch(n){throw j(n)}},be=async(m,n)=>{try{const w=await $.put(`/stickers/${m}`,n,{headers:{"Content-Type":"application/json"}});return F(w)}catch(w){throw j(w)}},ge=async m=>{try{const n=await $.delete(`/stickers/${m}`,{headers:{"Content-Type":"application/json"}});return F(n)}catch(n){throw j(n)}};const M=m=>(se("data-v-70232e08"),m=m(),ie(),m),he={class:"row items-center justify-between q-mt-md q-mb-md q-mx-md"},ye={class:"text-h5"},ke={class:"q-pa-md flex flex-center full-width full-height"},_e={key:0,class:"q-pa-md flex flex-center full-width full-height"},we={class:"q-mx-md"},qe=M(()=>c("div",{class:"row items-center justify-between q-mt-md q-mb-md"},[c("div",{class:"text-h5"},"Criar figurinha")],-1)),Se=M(()=>c("div",{class:"row items-center justify-between q-mt-md q-mb-md"},[c("div",{class:"text-h5"},"Figurinhas do \xE1lbum")],-1)),Ce={__name:"AlbumPage",setup(m){const n=O(),w=X(),{showSuccessNotification:S,showErrorNotification:y}=ve(),o=p(n.params.id||null),Q=p(null),t=p({imageUrl:null,imageBase64:"",title:"",description:"",community:!1,shared:!1,blocked:!1,editable:!1}),x=p(null),A=p(null),r=p({title:"",description:"",editable:!1}),u=p([]),J=Z(()=>!!o.value),g=p({albumTitle:"",albumDescription:"",cardStickerTitle:"",cardStickerDescription:""}),z=p(null),K=async()=>{z.value.click()},W=s=>{try{const e=s.target.files[0];if(e){const a=new FileReader;a.onload=v=>{t.value.imageUrl=v.target.result,t.value.imageBase64=new String(v.target.result).split(",")[1]},a.readAsDataURL(e)}}catch(e){y(e.message)}finally{}};ee(async()=>{if(J.value){b.show("Aguarde... Estamos carregando os dados para voc\xEA...");try{const s=await ue(o.value);s&&(t.value.imageUrl=s.imageUrl,t.value.title=s.title,t.value.description=s.description,t.value.community=s.community,t.value.shared=s.shared,t.value.blocked=s.blocked);const{stickers:e}=await de(o.value);for(let a=0;a<e.length;a++){const v=e[a];v.editable=!1,u.value.push(v)}}catch(s){y(s.message)}finally{b.hide()}}});const Y=()=>{w.push(me("inicio"))},D=async s=>{if(s==="edit")g.value.albumTitle=t.value.title,g.value.albumDescription=t.value.description;else if(s==="cancel")t.value.title=g.value.albumTitle,t.value.description=g.value.albumDescription,Q.value.resetValidation();else{if(Q.value.validate(),Q.value.hasError)return;try{if(b.show("Aguarde... Estamos salvando os dados para voc\xEA..."),o.value){const e=await ne(o.value,{id:o.value,imageBase64:t.value.imageBase64,title:t.value.title,description:t.value.description,community:t.value.community,shared:t.value.shared,blocked:t.value.shared});e.data&&S(e.message)}else{const e=await ce({imageBase64:t.value.imageBase64,title:t.value.title,description:t.value.description,community:t.value.community});e.data&&(o.value=e.data.id,w.push(`/edu/album/${o.value}`),S(e.message))}}catch(e){y(e.message)}finally{b.hide()}}t.value.editable=s==="add"?!1:!t.value.editable},E=async s=>{if(s==="cancel")r.value.title="",r.value.description="",x.value.resetValidation(),A.value.resetValidation();else{if(!o.value||(x.value.validate(),A.value.validate(),x.value.hasError||A.value.hasError))return;if(r.value.editable)try{b.show("Aguarde... Estamos salvando os dados para voc\xEA...");const e=await fe({title:r.value.title,description:r.value.description,albumId:o.value});e&&(u.value.push({id:e.data.id,title:e.data.title,description:e.data.description,editable:!1}),r.value.title="",r.value.description="",S(e.message))}catch(e){y(e.message)}finally{b.hide()}}r.value.editable=!r.value.editable},N=async(s,e)=>{if(e==="edit")g.value.cardStickerTitle=u.value[s].title,g.value.cardStickerDescription=u.value[s].description;else if(e==="cancel")u.value[s].title=g.value.cardStickerTitle,u.value[s].description=g.value.cardStickerDescription;else{if(new String(u.value[s].title).length==0||new String(u.value[s].description).length==0){y("Aten\xE7\xE3o! Certifique-se que os dados est\xE3o preenchidos corretamente.");return}if(u.value[s].editable)try{const a=await be(u.value[s].id,{id:u.value[s].id,title:u.value[s].title,description:u.value[s].description,albumId:o.value});a&&S(a.message)}catch(a){y(a.message)}finally{b.hide()}}u.value[s].editable=!u.value[s].editable},G=async s=>{try{b.show("Aguarde... Estamos removendo a figurinha do \xE1lbum...");const e=await ge(u.value[s].id);e&&(u.value.splice(s,1),S(e.message))}catch(e){y(e.message)}finally{b.hide()}};return(s,e)=>(h(),C(re,{class:"q-pa-md"},{default:i(()=>[c("div",he,[c("div",ye,ae(o.value?"Editar":"Criar")+" \xC1lbum",1),l(f,{rounded:"",color:"primary",class:"button",icon:"home",label:"In\xEDcio",onClick:Y})]),l(H,{class:"q-my-md q-mx-md"}),c("form",{onSubmit:P(D,["prevent","stop"])},[l(B,{class:"q-mb-md rounded-card q-mx-md flat bordered"},{default:i(()=>[l(U,{class:"q-pa-sm"},{default:i(()=>[l(T,{class:"row"},{default:i(()=>[l(k,{class:"col-12"},{default:i(()=>[l(_,{side:"",class:"q-flex q-flex-column q-align-start"},{default:i(()=>[l(oe,{src:t.value.imageUrl,style:{width:"190px",height:"250px","object-fit":"cover"}},{error:i(()=>[c("div",ke,[l(L,{name:"warning",size:"64px",color:"grey-4"})])]),default:i(()=>[t.value.imageUrl?V("",!0):(h(),I("div",_e,[l(L,{name:"add_photo_alternate",size:"64px",color:"grey-4"})]))]),_:1},8,["src"]),l(f,{rounded:"",color:"primary",label:"Carregar capa",icon:"upload",class:"text-capitalize q-mt-sm",disable:o.value&&!t.value.editable,onClick:e[0]||(e[0]=a=>K())},null,8,["disable"]),c("input",{type:"file",ref_key:"fileInput",ref:z,onChange:W,accept:"image/*",style:{display:"none"}},null,544)]),_:1})]),_:1}),l(k,{class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},{default:i(()=>[l(_,null,{default:i(()=>[l(q,{rounded:"",outlined:"",ref_key:"albumDataTitleRef",ref:Q,modelValue:t.value.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.title=a),label:"T\xEDtulo *",class:"q-mb-md",disable:o.value&&!t.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para o \xE1lbum."]},null,8,["modelValue","disable","rules"])]),_:1})]),_:1}),l(k,{class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},{default:i(()=>[l(_,null,{default:i(()=>[l(q,{rounded:"",outlined:"",modelValue:t.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.description=a),label:"Descri\xE7\xE3o",type:"textarea",class:"q-mb-md",disable:o.value&&!t.value.editable},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1}),l(R,{align:"right"},{default:i(()=>[l(f,{rounded:"",class:"button",color:"primary",label:o.value?t.value.editable?"Salvar":"Editar":"Criar novo",icon:o.value?t.value.editable?"save":"edit":"add",onClick:e[3]||(e[3]=a=>D(o.value?t.value.editable?"save":"edit":"add"))},null,8,["label","icon"]),t.value.editable?(h(),C(f,{key:0,rounded:"",color:"negative",label:"Cancelar",icon:"cancel",onClick:e[4]||(e[4]=a=>D("cancel"))})):V("",!0)]),_:1})]),_:1})],32),l(H,{class:"q-my-md q-mx-md"}),c("div",we,[qe,c("form",{onSubmit:P(E,["prevent","stop"])},[l(B,{class:"q-mb-md rounded-card"},{default:i(()=>[l(U,{class:"q-pa-sm"},{default:i(()=>[l(T,{class:"row"},{default:i(()=>[l(k,{class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},{default:i(()=>[l(_,null,{default:i(()=>[l(q,{rounded:"",outlined:"",ref_key:"formStickerTitleRef",ref:x,modelValue:r.value.title,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.title=a),label:"T\xEDtulo *",class:"q-mb-sm",disable:!r.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para a figurinha."]},null,8,["modelValue","disable","rules"])]),_:1})]),_:1}),l(k,{class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},{default:i(()=>[l(_,null,{default:i(()=>[l(q,{rounded:"",outlined:"",ref_key:"formStickerDescriptionRef",ref:A,modelValue:r.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.description=a),label:"Descri\xE7\xE3o *",type:"textarea",disable:!r.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar uma descri\xE7\xE3o para a figurinha."]},null,8,["modelValue","disable","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),l(R,{align:"right"},{default:i(()=>[l(f,{rounded:"",color:"primary",disable:!o.value,label:r.value.editable?"Salvar":"Criar nova",icon:r.value.editable?"save":"add",onClick:e[7]||(e[7]=a=>E("add")),class:"q-ml-md"},null,8,["disable","label","icon"]),r.value.editable?(h(),C(f,{key:0,rounded:"",color:"negative",label:"Cancelar",icon:"cancel",onClick:e[8]||(e[8]=a=>E("cancel")),class:"q-ml-md"})):V("",!0)]),_:1})]),_:1})],32),Se,(h(!0),I(te,null,le(u.value,(a,v)=>(h(),I("div",{key:v,class:"q-mb-md"},[l(B,{class:"q-mb-md rounded-card"},{default:i(()=>[l(U,{class:"q-pa-sm"},{default:i(()=>[l(T,{class:"row"},{default:i(()=>[l(k,{class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},{default:i(()=>[l(_,null,{default:i(()=>[l(q,{rounded:"",outlined:"",modelValue:a.title,"onUpdate:modelValue":d=>a.title=d,label:"T\xEDtulo",disable:!a.editable,rules:[d=>d&&d.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para a figurinha."]},null,8,["modelValue","onUpdate:modelValue","disable","rules"])]),_:2},1024)]),_:2},1024),l(k,{class:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},{default:i(()=>[l(_,null,{default:i(()=>[l(q,{rounded:"",outlined:"",modelValue:a.description,"onUpdate:modelValue":d=>a.description=d,label:"Descri\xE7\xE3o",type:"textarea",disable:!a.editable,rules:[d=>d&&d.length>0||"\xC9 necess\xE1rio informar uma descri\xE7\xE3o para a figurinha."]},null,8,["modelValue","onUpdate:modelValue","disable","rules"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),l(R,{align:"right"},{default:i(()=>[l(f,{rounded:"",color:"primary",label:a.editable?"Salvar":"Editar",icon:a.editable?"save":"edit",onClick:d=>N(v,a.editable?"save":"edit"),class:"q-ml-md"},null,8,["label","icon","onClick"]),a.editable?(h(),C(f,{key:0,rounded:"",color:"negative",icon:"cancel",onClick:d=>N(v,"cancel"),label:"Cancelar",class:"q-ml-md"},null,8,["onClick"])):V("",!0),a.editable?V("",!0):(h(),C(f,{key:1,rounded:"",color:"negative",icon:"delete",label:"Excluir",onClick:d=>G(v),class:"q-ml-md"},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]))),128))])]),_:1}))}};var Pe=pe(Ce,[["__scopeId","data-v-70232e08"]]);export{Pe as default};
