import{ax as T,az as I,aA as U,aJ as J,U as K,r as v,c as W,o as G,k as y,l as S,m as k,n as o,au as O,f as s,Q as p,S as X,aK as A,W as R,R as $,aB as Y,F as Z,p as ee,q as ae}from"./index.1986f44e.js";import{Q as j}from"./QSeparator.72ea0157.js";import{Q as le}from"./QImg.6228933a.js";import{Q as _}from"./QInput.83a57daa.js";import{a as x,Q as F}from"./QCard.9316d876.js";import{Q as te}from"./QPage.383a434d.js";import{f as ie,a as se,u as oe,c as re}from"./albumsService.29f6f2c6.js";import{g as ne}from"./routeHelpers.aa0e86a6.js";import{H as b}from"./loaderUtils.d105dfeb.js";import{u as de}from"./notificationUtils.4da15e15.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.32f1eb0d.js";import"./use-timeout.88b09f9d.js";import"./focus-manager.40072c15.js";const ce=async c=>{try{const u=await T.post("/stickers",c,{headers:{"Content-Type":"application/json"}});return I(u)}catch(u){throw U(u)}},me=async(c,u)=>{try{const h=await T.put(`/stickers/${c}`,u,{headers:{"Content-Type":"application/json"}});return I(h)}catch(h){throw U(h)}},ve=async c=>{try{const u=await T.delete(`/stickers/${c}`,{headers:{"Content-Type":"application/json"}});return I(u)}catch(u){throw U(u)}};const N=c=>(ee("data-v-dbb29bf0"),c=c(),ae(),c),pe={class:"row items-center justify-between q-mt-md q-mb-md q-mx-md"},be={class:"text-h4"},fe={class:"row q-gutter-md q-pa-md items-start q-mx-md"},ge={class:"col-12 col-md-2 image-container"},ye={class:"q-pa-md flex flex-center full-width full-height"},he={class:"col-12 col-md-9"},ke={class:"row justify-end q-pa-md q-mx-md"},_e={class:"q-mx-md"},we=N(()=>o("div",{class:"row items-center justify-between q-mt-md q-mb-md"},[o("div",{class:"text-h4"},"Criar figurinha")],-1)),Se={class:"col-10"},qe={class:"col-2 row items-center"},Ce=N(()=>o("div",{class:"row items-center justify-between q-mt-md q-mb-md"},[o("div",{class:"text-h4"},"Figurinhas do \xE1lbum")],-1)),Ve={class:"col-10"},Ae={class:"col-2 row items-center"},De={__name:"AlbumPage",setup(c){const u=J(),h=K(),{showSuccessNotification:w,showErrorNotification:g}=de(),i=v(u.params.id||null),q=v(null),l=v({imageUrl:null,imageBase64:"",title:"",description:"",community:!1,shared:!1,blocked:!1,editable:!1}),C=v(null),V=v(null),r=v({title:"",description:"",editable:!1}),n=v([]),z=W(()=>!!i.value),f=v({albumTitle:"",albumDescription:"",cardStickerTitle:"",cardStickerDescription:""}),B=v(null),P=async()=>{B.value.click()},H=t=>{try{const e=t.target.files[0];if(e){const a=new FileReader;a.onload=m=>{l.value.imageUrl=m.target.result,l.value.imageBase64=new String(m.target.result).split(",")[1]},a.readAsDataURL(e)}}catch(e){g(e.message)}finally{}};G(async()=>{if(z.value){b.show("Aguarde... Estamos carregando os dados para voc\xEA...");try{const t=await ie(i.value);t&&(l.value.imageUrl=t.imageUrl,l.value.title=t.title,l.value.description=t.description,l.value.community=t.community,l.value.shared=t.shared,l.value.blocked=t.blocked);const{stickers:e}=await se(i.value);for(let a=0;a<e.length;a++){const m=e[a];m.editable=!1,n.value.push(m)}}catch(t){g(t.message)}finally{b.hide()}}});const L=()=>{h.push(ne("inicio"))},D=async t=>{if(t==="edit")f.value.albumTitle=l.value.title,f.value.albumDescription=l.value.description;else if(t==="cancel")l.value.title=f.value.albumTitle,l.value.description=f.value.albumDescription,q.value.resetValidation();else{if(q.value.validate(),q.value.hasError)return;try{if(b.show("Aguarde... Estamos salvando os dados para voc\xEA..."),i.value){const e=await oe(i.value,{id:i.value,imageBase64:l.value.imageBase64,title:l.value.title,description:l.value.description,community:l.value.community,shared:l.value.shared,blocked:l.value.shared});e.data&&w(e.message)}else{const e=await re({imageBase64:l.value.imageBase64,title:l.value.title,description:l.value.description,community:l.value.community});e.data&&(i.value=e.data.id,h.push(`/edu/album/${i.value}`),w(e.message))}}catch(e){g(e.message)}finally{b.hide()}}l.value.editable=t==="add"?!1:!l.value.editable},E=async t=>{if(t==="cancel")r.value.title="",r.value.description="",C.value.resetValidation(),V.value.resetValidation();else{if(!i.value||(C.value.validate(),V.value.validate(),C.value.hasError||V.value.hasError))return;if(r.value.editable)try{b.show("Aguarde... Estamos salvando os dados para voc\xEA...");const e=await ce({title:r.value.title,description:r.value.description,albumId:i.value});e&&(n.value.push({id:e.data.id,title:e.data.title,description:e.data.description,editable:!1}),r.value.title="",r.value.description="",w(e.message))}catch(e){g(e.message)}finally{b.hide()}}r.value.editable=!r.value.editable},Q=async(t,e)=>{if(e==="edit")f.value.cardStickerTitle=n.value[t].title,f.value.cardStickerDescription=n.value[t].description;else if(e==="cancel")n.value[t].title=f.value.cardStickerTitle,n.value[t].description=f.value.cardStickerDescription;else{if(new String(n.value[t].title).length==0||new String(n.value[t].description).length==0){g("Aten\xE7\xE3o! Certifique-se que os dados est\xE3o preenchidos corretamente.");return}if(n.value[t].editable)try{const a=await me(n.value[t].id,{id:n.value[t].id,title:n.value[t].title,description:n.value[t].description,albumId:i.value});a&&w(a.message)}catch(a){g(a.message)}finally{b.hide()}}n.value[t].editable=!n.value[t].editable},M=async t=>{try{b.show("Aguarde... Estamos removendo a figurinha do \xE1lbum...");const e=await ve(n.value[t].id);e&&(n.value.splice(t,1),w(e.message))}catch(e){g(e.message)}finally{b.hide()}};return(t,e)=>(y(),S(te,{class:"q-pa-md"},{default:k(()=>[o("div",pe,[o("div",be,O(i.value?"Editar":"Criar")+" \xC1lbum",1),s(p,{rounded:"",color:"primary",class:"button",icon:"home",label:"In\xEDcio",onClick:L})]),s(j,{class:"q-my-md q-mx-md"}),o("form",{onSubmit:R(D,["prevent","stop"])},[o("div",fe,[o("div",ge,[s(le,{src:l.value.imageUrl?l.value.imageUrl:"https://cdn.quasar.dev/img/parallax2.jpg"},{error:k(()=>[o("div",ye,[s(X,{name:"camera",color:"grey-4"})])]),_:1},8,["src"]),s(p,{rounded:"",color:"primary",label:"Carregar",icon:"upload",disable:i.value&&!l.value.editable,onClick:e[0]||(e[0]=a=>P())},null,8,["disable"]),o("input",{type:"file",ref_key:"fileInput",ref:B,onChange:H,accept:"image/*",style:{display:"none"}},null,544)]),o("div",he,[s(_,{rounded:"",outlined:"",ref_key:"albumDataTitleRef",ref:q,modelValue:l.value.title,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.title=a),label:"T\xEDtulo *",class:"q-mb-md",disable:i.value&&!l.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para o \xE1lbum."]},null,8,["modelValue","disable","rules"]),s(_,{rounded:"",outlined:"",modelValue:l.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.description=a),label:"Descri\xE7\xE3o",type:"textarea",class:"q-mb-md",disable:i.value&&!l.value.editable},null,8,["modelValue","disable"])])]),o("div",ke,[s(p,{rounded:"",class:"button",color:"primary",label:i.value?l.value.editable?"Salvar":"Editar":"Criar novo",icon:i.value?l.value.editable?"save":"edit":"add",onClick:e[3]||(e[3]=a=>D(i.value?l.value.editable?"save":"edit":"add"))},null,8,["label","icon"]),l.value.editable?(y(),S(p,{key:0,rounded:"",color:"negative",label:"Cancelar",icon:"cancel",onClick:e[4]||(e[4]=a=>D("cancel"))})):A("",!0)])],32),s(j,{class:"q-my-md q-mx-md"}),o("div",_e,[we,o("form",{onSubmit:R(E,["prevent","stop"])},[s(F,{class:"q-mb-md rounded-card"},{default:k(()=>[s(x,{class:"row items-center justify-between"},{default:k(()=>[o("div",Se,[s(_,{rounded:"",outlined:"",ref_key:"formStickerTitleRef",ref:C,modelValue:r.value.title,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.title=a),label:"T\xEDtulo *",class:"q-mb-sm",disable:!r.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para a figurinha."]},null,8,["modelValue","disable","rules"]),s(_,{rounded:"",outlined:"",ref_key:"formStickerDescriptionRef",ref:V,modelValue:r.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.description=a),label:"Descri\xE7\xE3o *",type:"textarea",disable:!r.value.editable,"lazy-rules":"",rules:[a=>a&&a.length>0||"\xC9 necess\xE1rio informar uma descri\xE7\xE3o para a figurinha."]},null,8,["modelValue","disable","rules"])]),o("div",qe,[s(p,{rounded:"",color:"primary",disable:!i.value,label:r.value.editable?"Salvar":"Criar nova",icon:r.value.editable?"save":"add",onClick:e[7]||(e[7]=a=>E("add")),class:"q-ml-md"},null,8,["disable","label","icon"]),r.value.editable?(y(),S(p,{key:0,rounded:"",color:"negative",label:"Cancelar",icon:"cancel",onClick:e[8]||(e[8]=a=>E("cancel")),class:"q-ml-md"})):A("",!0)])]),_:1})]),_:1})],32),Ce,(y(!0),$(Z,null,Y(n.value,(a,m)=>(y(),$("div",{key:m,class:"q-mb-md"},[s(F,{class:"q-mb-md rounded-card"},{default:k(()=>[s(x,{class:"row items-center justify-between"},{default:k(()=>[o("div",Ve,[s(_,{rounded:"",outlined:"",modelValue:a.title,"onUpdate:modelValue":d=>a.title=d,label:"T\xEDtulo",disable:!a.editable,rules:[d=>d&&d.length>0||"\xC9 necess\xE1rio informar um t\xEDtulo para a figurinha."]},null,8,["modelValue","onUpdate:modelValue","disable","rules"]),s(_,{rounded:"",outlined:"",modelValue:a.description,"onUpdate:modelValue":d=>a.description=d,label:"Descri\xE7\xE3o",type:"textarea",disable:!a.editable,rules:[d=>d&&d.length>0||"\xC9 necess\xE1rio informar uma descri\xE7\xE3o para a figurinha."]},null,8,["modelValue","onUpdate:modelValue","disable","rules"])]),o("div",Ae,[s(p,{rounded:"",color:"primary",label:a.editable?"Salvar":"Editar",icon:a.editable?"save":"edit",onClick:d=>Q(m,a.editable?"save":"edit"),class:"q-ml-md"},null,8,["label","icon","onClick"]),a.editable?(y(),S(p,{key:0,rounded:"",color:"negative",icon:"cancel",onClick:d=>Q(m,"cancel"),label:"Cancelar",class:"q-ml-md"},null,8,["onClick"])):A("",!0),a.editable?A("",!0):(y(),S(p,{key:1,rounded:"",color:"negative",icon:"delete",label:"Excluir",onClick:d=>M(m),class:"q-ml-md"},null,8,["onClick"]))])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1}))}};var He=ue(De,[["__scopeId","data-v-dbb29bf0"]]);export{He as default};
